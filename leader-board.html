<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1, width=device-width" />

    <link rel="stylesheet" href="./global.css" />
    <link rel="stylesheet" href="./leader-board.css" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Autour One:wght@400&display=swap"
    />

    <style>
      @font-face {
        font-family: "Xtra";
        src: url("./public/Xtra.ttf");
        font-weight: 400;
      }
      @font-face {
        font-family: "GemFont One";
        src: url("./public/GemFont One.ttf");
        font-weight: 400;
      }
      @font-face {
        font-family: "Greek-Freak";
        src: url("./public/Greek-Freak.ttf");
        font-weight: 400;
      }
      @font-face {
        font-family: "Greek";
        src: url("./public/Greek-Regular.ttf");
        font-weight: 400;
      }
      @font-face {
        font-family: "Augusta";
        src: url("./public/Augusta.ttf");
        font-weight: 400;
      }
    </style>
  </head>

  <body>
    <div class="leaderboard9">
      <div class="leaderboard-wrapper">
        <h2 class="leaderboard10">LEADERBOARD</h2>
      </div>
      <main class="user-row">
        <img
          class="soti1111-scene-of-an-ancient-g-icon2"
          alt=""
          src="./public/soti1111-scene-of-an-ancient-greek-ornate-altar-with-greek-symb-443696c315ce43ca98fe120e80f26663-11@2x.png"
        />

        <section class="rectangle-parent2">
          <footer class="frame-child13"></footer>
          <div class="frame-child14"></div>
        </section>
        <img
          class="back-button-icon9"
          alt=""
          onclick="history.back()"
          style="cursor: pointer;"
          src="./public/back-button@2x.png"
        />

        <img
          class="settings-button-icon9"
          loading="lazy"
          alt=""
          src="./public/settings-button@2x.png" style="display: none;"
        />

        <section class="frame-section">
          <img
            class="leaderboard-icon"
            alt=""
            src="./public/leaderboard@2x.png"
          />

          <div class="hercules" id="top1Name">Loading...</div>
          <div class="div1" id="top1Balance">0</div>
          <div class="badge-spacer" id="top1Rank">#1</div>
          <div class="line-div"></div>
          <div class="frame-child15"></div>
        </section>
        <img
          class="gold-badge-2-1"
          loading="lazy"
          alt=""
          src="./public/gold-badge-2-1@2x.png"
        />

        <img
          class="user-icon1"
          loading="lazy"
          alt=""
          src="./public/user-icon1@2x.png"
        />

        <img class="coin-icon7" alt="" src="./public/coin2@2x.png" />

        <img
          class="user-icon2"
          loading="lazy"
          alt=""
          src="./public/user-icon-1@2x.png"
        />

        <img
          class="silver-badge-2"
          loading="lazy"
          alt=""
          src="./public/silver-badge-2@2x.png"
        />

        <img class="coin-icon8" alt="" src="./public/coin2@2x.png" />

        <img
          class="bronze-badge-1"
          loading="lazy"
          alt=""
          src="./public/bronze-badge-1@2x.png"
        />

        <img
          class="user-icon3"
          loading="lazy"
          alt=""
          src="./public/user-icon-2@2x.png"
        />

        <img class="coin-icon9" alt="" src="./public/coin2@2x.png" />

        <img
          class="user-icon4"
          loading="lazy"
          alt=""
          src="./public/user-icon1@2x.png"
        />

        <img
          class="coin-icon10"
          loading="lazy"
          alt=""
          src="./public/coin2@2x.png"
        />

        <img
          class="user-icon5"
          loading="lazy"
          alt=""
          src="./public/user-icon1@2x.png"
        />

        <img
          class="coin-icon11"
          loading="lazy"
          alt=""
          src="./public/coin2@2x.png"
        />

        <img
          class="user-icon6"
          loading="lazy"
          alt=""
          src="./public/user-icon1@2x.png"
        />

        <img
          class="coin-icon12"
          loading="lazy"
          alt=""
          src="./public/coin2@2x.png"
        />

        <img
          class="bronze-badge-2"
          loading="lazy"
          alt=""
          src="./public/bronze-badge-1@2x.png"
        />

        <img
          class="gold-badge-2-11"
          loading="lazy"
          alt=""
          src="./public/gold-badge-2-1@2x.png"
        />

        <img
          class="silver-badge-21"
          loading="lazy"
          alt=""
          src="./public/silver-badge-2-1@2x.png"
        />
      </main>
      <div class="frame-parent17">
        <div class="prizes-wrapper">
          <h2 class="prizes">PRIZES</h2>
        </div>
        <div class="user-comparison">
          <div class="navigation">
            <div class="navigation-child"></div>
            <div class="shop-navigation">
              <div class="shop-icon-wrapper3">
                <img
                  class="shop-icon9"
                  loading="lazy"
                  alt=""
                  src="./public/shop-icon@2x.png"
                />
              </div>
              <div class="referral9">Referral</div>
            </div>
            <div class="shop-navigation">
              <img
                class="quest-icom-icon9"
                loading="lazy"
                alt=""
                src="./public/quest-icom@2x.png"
              />

              <div class="quests-wrapper4">
                <div class="quests9">Quests</div>
              </div>
            </div>
            <div class="leaderboard-navigation">
              <div class="leaderboard11">Leaderboard</div>
              <img
                class="trophy-icon9"
                loading="lazy"
                alt=""
                src="./public/trophy-icon@2x.png"
              />
            </div>
          </div>
          <div class="scrollwheel">
            <div class="scrollwheel1"></div>
          </div>
          <div class="hercules1">Hercules</div>
          <div class="empty-coin">2,345</div>
          <div class="a1" id="top2Name">Loading...</div>
          <div class="div2" id="top2Balance">0</div>
          <div class="ares" id="top3Name">Loading...</div>
          <div class="div3" id="top3Balance">0</div>
          <div class="hercules2" id="top4Name">Loading...</div>
          <div class="div4" id="top4Balance">0</div>
          <div class="badge-spacer1" id="top4Rank">#4</div>
          <div class="hercules3" id="top5Name">Loading...</div>
          <div class="div5" id="top5Balance">0</div>
          <div class="badge-spacer2" id="top5Rank">#5</div>
          <div class="you">
            <div class="user-rank-value-wrapper">
              <div class="user-rank-value" id="userRank">#-</div>
            </div>
            <img 
              class="user-icon7"
              loading="lazy"
              alt=""
              src="./public/user-icon-6@2x.png"
            />

            <div class="user-balance-details-wrapper">
              <div class="user-balance-details">
                <div class="user-balance-details-inner">
                  <div class="frame-child16"></div>
                </div>
                <div class="user-name-and-coins">
                  <div class="you1" id="userName">YOU</div>
                  <div class="frame-parent18">
                    <div class="user-coin-value-wrapper">
                      <div class="user-rank-value" id="userBalance">0</div>
                    </div>
                    <img
                      class="coin-icon13"
                      loading="lazy"
                      alt=""
                      src="./public/coin2@2x.png"
                    />
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="coin-balance1">
            <img class="coin-icon13" alt="" src="./public/coin2@2x.png" />

            <div class="third-coin-value-wrapper">
              <div class="third-coin-value">1,000</div>
            </div>
          </div>
          <div class="coin-balance2">
            <img
              class="coin-icon15"
              loading="lazy"
              alt=""
              src="./public/coin-8@2x.png"
            />

            <div class="second-coin-value">3,000</div>
          </div>
          <div class="coin-balance3">
            <img class="coin-icon13" alt="" src="./public/coin2@2x.png" />

            <div class="third-coin-value-wrapper">
              <div class="first-coin-value">2,000</div>
            </div>
          </div>
          <div class="user-comparison-child"></div>
          <div class="user-comparison-item"></div>
          <div class="user-comparison-inner"></div>
          <div class="user-comparison-child1"></div>
          <div class="user-comparison-child2"></div>
        </div>
      </div>
    </div>

    <script>
      // Constants
      const PLACEHOLDER_USERNAME = 'testuser';
      const PRIZE_AMOUNTS = [3000, 2000, 1000];
      const API_BASE_URL = 'http://localhost:3000/api';

      // Initialize leaderboard
      async function initializeLeaderboard() {
        try {
          // Fetch all users and sort by balance
          const response = await fetch(`${API_BASE_URL}/users/leaderboard`);
          const users = await response.json();

          // Sort users by balance in descending order
          users.sort((a, b) => b.balance - a.balance);

          // Update prize amounts
          // Update top 5 players
          for (let i = 0; i < 5 && i < users.length; i++) {
            const user = users[i];
            const rank = i + 1;

            // Update UI elements
            document.getElementById(`top${rank}Name`).textContent = user.username;
            document.getElementById(`top${rank}Balance`).textContent = user.balance.toLocaleString();
            if (document.getElementById(`top${rank}Rank`)) {
              document.getElementById(`top${rank}Rank`).textContent = `#${rank}`;
            }
            
            // Add badge classes
            if (rank === 1) {
              document.getElementById('top1Name').classList.add('gold-rank');
              document.querySelector('.gold-badge-2-1').style.display = 'block';
            } else if (rank === 2) {
              document.getElementById('top2Name').classList.add('silver-rank');
              document.querySelector('.silver-badge-2').style.display = 'block';
            } else if (rank === 3) {
              document.getElementById('top3Name').classList.add('bronze-rank');
              document.querySelector('.bronze-badge-1').style.display = 'block';
            }
            
          }

          // Find current user's position
          const currentUser = users.find(user => user.username === PLACEHOLDER_USERNAME);
          if (currentUser) {
            const userRank = users.findIndex(user => user.username === PLACEHOLDER_USERNAME) + 1;
            document.getElementById('userRank').textContent = `#${userRank}`;
            document.getElementById('userName').textContent = currentUser.username;
            document.getElementById('userBalance').textContent = currentUser.balance.toLocaleString();
            
            // Highlight user's position
            const userRow = document.querySelector('.you');
            if (userRank <= 3) {
              userRow.classList.add(`rank-${userRank}`);
            } else {
              userRow.classList.add('normal-rank');
            }
          }

        } catch (error) {
          console.error('Error fetching leaderboard:', error);
          // Show error state in UI
          showErrorState();
        }
      }

      // Show error state in UI
      function showErrorState() {
        const errorElements = [
          'top1Name', 'top2Name', 'top3Name', 'top4Name', 'top5Name',
          'top1Balance', 'top2Balance', 'top3Balance', 'top4Balance', 'top5Balance'
        ];

        errorElements.forEach(id => {
          const element = document.getElementById(id);
          if (element) {
            if (id.includes('Name')) {
              element.textContent = 'Error loading data';
            } else {
              element.textContent = '0';
            }
          }
        });
      }

      // Add navigation event listeners
      function addNavigationListeners() {
        document.querySelector('.referral9').addEventListener('click', () => {
          window.location.href = './referral.html';
        });

        document.querySelector('.quests9').addEventListener('click', () => {
          window.location.href = './quest.html';
        });
      }

      // Add click handlers for navigation
      document.addEventListener('DOMContentLoaded', function() {
        // Quest button
        const questButton = document.querySelector('.quest-icom-icon9');
        if (questButton) {
          questButton.addEventListener('click', () => window.location.href = './quest.html');
        }

        // Referral button
        const referralButton = document.querySelector('.shop-icon9');
        if (referralButton) {
          referralButton.addEventListener('click', () => window.location.href = './referral.html');
        }

        // Initialize leaderboard
        initializeLeaderboard();

        // Add navigation listeners
        addNavigationListeners();

        // Refresh leaderboard every minute
        setInterval(initializeLeaderboard, 60000);
      });
    </script>
  </body>
</html>
