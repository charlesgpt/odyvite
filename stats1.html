<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1, width=device-width" />
    <link rel="stylesheet" href="./global.css" />
    <link rel="stylesheet" href="./stats.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Autour One:wght@400&display=swap" />
    <style>
      @font-face {
        font-family: "Xtra";
        src: url("./public/Xtra.ttf");
        font-weight: 400;
      }
      @font-face {
        font-family: "GemFont One";
        src: url("./public/GemFont One.ttf");
        font-weight: 400;
      }
      @font-face {
        font-family: "Greek-Freak";
        src: url("./public/Greek-Freak.ttf");
        font-weight: 400;
      }
      @font-face {
        font-family: "Greek";
        src: url("./public/Greek-Regular.ttf");
        font-weight: 400;
      }
      @font-face {
        font-family: "Augusta";
        src: url("./public/Augusta.ttf");
        font-weight: 400;
      }
    </style>
  </head>
  <body>
    <div class="stats">
      <img class="bg-icon1" alt="" src="./public/bg@2x.png" />
      <img class="image-103-icon1" alt="" src="./public/image-103@2x.png" />
      <img class="soti1111-scene-of-an-ancient-g-icon3" alt="" src="./public/soti1111-scene-of-an-ancient-greek-coin-flipping-in-midair-glo-ad535c06450d4988be9bab2507b82aa8-1@2x.png" />
      <img class="stats-child" alt="" src="./public/frame-13@2x.png" />

      <main class="scene-container">
        <img class="soti1111-scene-of-an-ancient-g-icon4" alt="" src="./public/soti1111-scene-of-an-ancient-greek-ornate-altar-with-greek-symb-443696c315ce43ca98fe120e80f26663-11@2x.png" />
        <section class="rectangle-parent3">
          <footer class="frame-child17"></footer>
          <textarea class="rectangle-textarea" rows="{16}" cols="{25}"></textarea>
        </section>
        <img class="back-button-icon10" loading="lazy" alt="" src="./public/back-button@2x.png" onclick="history.back()" style="cursor: pointer;" />
        <img class="settings-button-icon10" loading="lazy" alt="" src="./public/settings-button@2x.png" />
      </main>

      <div class="stats-inner">
        <div class="title-scroll-parent3">
          <img class="title-scroll-icon9" alt="" src="./public/title-scroll@2x.png" />
          <a class="risk-profile">Risk Profile</a>
        </div>
      </div>

      <div class="frame-parent19">
        <div class="panel3-1-parent">
          <img class="panel3-1-icon" alt="" src="./public/panel3-1@2x.png" />
          <div class="optimal-strategist-wrapper">
            <div class="optimal-strategist" id="playerCategory">Analyzing...</div>
          </div>
          <div class="your-decisions-align-with-a-ma-wrapper">
            <div class="your-decisions-align" id="categoryDescription">
              Analyzing your betting patterns...
            </div>
          </div>
          <div class="frame-wrapper7">
            <div class="frame-parent20">
              <div class="frame-parent21">
                <div class="average-bet-value-container-parent">
                  <div class="average-bet-value-container">
                    <div class="average-bet-wrapper">
                      <div class="optimal-strategist">Average Bet</div>
                    </div>
                    <div class="frame-parent22">
                      <div class="average-bet-divider-wrapper">
                        <div class="average-bet-divider" id="averageBet">0</div>
                      </div>
                      <div class="optimal-bet-icon-wrapper">
                        <img class="optimal-bet-icon" loading="lazy" alt="" src="./public/vector-3.svg" />
                      </div>
                      <div class="optimal-bet-parent">
                        <div class="optimal-bet">Optimal Bet %</div>
                        <div class="optimal-bet-divider-wrapper">
                          <div class="optimal-bet-divider" id="optimalBetPercent">0%</div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="frame-parent23">
                    <div class="vector-wrapper">
                      <img class="frame-child18" loading="lazy" alt="" src="./public/vector-1.svg" />
                    </div>
                    <img class="frame-child19" loading="lazy" alt="" src="./public/vector-1.svg" />
                  </div>
                </div>
                <div class="average-bet-parent">
                  <div class="optimal-bet">Average Bet %</div>
                  <div class="wealth-value-container-wrapper">
                    <div class="wealth-value-container">
                      <div class="wealth-value-wrapper">
                        <div class="optimal-bet-divider" id="averageBetPercent">0%</div>
                      </div>
                      <div class="wealth-icon-container-parent">
                        <div class="wealth-icon-container">
                          <img class="optimal-bet-icon" loading="lazy" alt="" src="./public/vector-4.svg" />
                        </div>
                        <div class="final-wealth-parent">
                          <div class="optimal-bet">Final Wealth</div>
                          <div class="final-wealth-value-container-wrapper">
                            <div class="final-wealth-value-container">
                              <div class="optimal-bet-divider" id="finalWealth">0</div>
                              <div class="coin-wrapper1">
                                <img class="coin-icon17" loading="lazy" alt="" src="./public/coin2@2x.png" />
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="button-wrapper">
                <div class="button1">
                  <img class="button-icon14" alt="" src="./public/button@2x.png" />
                  <div class="continue4">Continue</div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="rectangle-parent4">
          <div class="frame-child20"></div>
          <div class="frame-parent24">
            <div class="shop-icon-wrapper4">
              <img class="shop-icon10" loading="lazy" alt="" src="./public/shop-icon@2x.png" />
            </div>
            <div class="referral10">Referral</div>
          </div>
          <div class="frame-parent24">
            <img class="quest-icom-icon10" loading="lazy" alt="" src="./public/quest-icom@2x.png" />
            <div class="quests-wrapper5">
              <div class="quests10">Quests</div>
            </div>
          </div>
          <div class="leaderboard-parent4">
            <div class="leaderboard12">Leaderboard</div>
            <img class="trophy-icon10" loading="lazy" alt="" src="./public/trophy-icon@2x.png" />
          </div>
        </div>
      </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get betting history from localStorage
            const resultHistory = JSON.parse(localStorage.getItem('resultHistory') || '[]');
            const chartHistory = JSON.parse(localStorage.getItem('chartHistory') || '[100]');
            const marketState = localStorage.getItem('marketState') || 'choppy';

            // Kelly fractions for each market state
            const kellyFractions = {
                bull: 0.4,    // 70% win probability
                bear: 0.06,   // 53% win probability
                choppy: 0.2   // 60% win probability
            };

            // Calculate optimal bet size based on market state
            const optimalBetSize = kellyFractions[marketState];
            
            // Analyze betting behavior
            let optimalBets = 0;
            let riskTakerBets = 0;
            let conservativeBets = 0;
            let totalBets = resultHistory.length;
            let totalBetAmount = 0;

            // Calculate bet sizes relative to balance
            for (let i = 1; i < chartHistory.length; i++) {
                const previousBalance = chartHistory[i-1];
                const currentBalance = chartHistory[i];
                const betAmount = Math.abs(currentBalance - previousBalance);
                const betFraction = betAmount / previousBalance;
                totalBetAmount += betAmount;

                // Categorize bet
                if (Math.abs(betFraction - optimalBetSize) < 0.1 * optimalBetSize) {
                    optimalBets++;
                } else if (betFraction > 1.2 * optimalBetSize) {
                    riskTakerBets++;
                } else if (betFraction < 0.2 * optimalBetSize) {
                    conservativeBets++;
                }
            }

            // Calculate metrics
            const averageBet = totalBets ? Math.round(totalBetAmount / totalBets) : 0;
            const averageBetPercent = totalBets ? Math.round((totalBetAmount / totalBets / 100) * 100) : 0;
            const finalWealth = chartHistory[chartHistory.length - 1];
            const optimalBetPercent = totalBets ? Math.round((optimalBets / totalBets) * 100) : 0;

            // Determine player category and description
            let category = "Analyzing...";
            let description = "Analyzing your betting patterns...";

            if (totalBets > 0) {
                if ((optimalBets / totalBets) >= 0.8) {
                    category = "Optimal Strategist";
                    description = "Your decisions align with a mastery of calculated risk-taking, showcasing an impressive understanding of the balance between growth and preservation. Like an architect of probability, you leveraged the Kelly criterion to optimize your choices, maintaining discipline even in the face of uncertainty.";
                } else if ((riskTakerBets / totalBets) > 0.5) {
                    category = "Risk-Taker";
                    description = "Your betting style shows a preference for aggressive positions. While this can lead to significant gains, it also exposes you to higher risks. Your bold approach demonstrates confidence, but consider incorporating more strategic elements for long-term success.";
                } else if ((conservativeBets / totalBets) > 0.5) {
                    category = "Conservative Player";
                    description = "You tend to bet cautiously, prioritizing capital preservation. While this approach provides stability, it may limit potential returns. Consider gradually exploring more optimal betting strategies to maximize your growth while maintaining risk control.";
                } else if ((riskTakerBets / totalBets) >= 0.3 && (conservativeBets / totalBets) >= 0.3) {
                    category = "Inconsistent Player";
                    description = "Your betting pattern shows significant variation between aggressive and conservative approaches. While adaptability can be valuable, a more consistent strategy aligned with optimal betting principles could improve your overall performance.";
                }
            }

            // Update UI
            document.getElementById('playerCategory').textContent = category;
            document.getElementById('categoryDescription').textContent = description;
            document.getElementById('averageBet').textContent = averageBet;
            document.getElementById('averageBetPercent').textContent = `${averageBetPercent}%`;
            document.getElementById('optimalBetPercent').textContent = `${optimalBetPercent}%`;
            document.getElementById('finalWealth').textContent = finalWealth;
        });
    </script>
  </body>
</html>
