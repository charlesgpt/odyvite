<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1, width=device-width" />

    <link rel="stylesheet" href="./global.css" />
    <link rel="stylesheet" href="./market-state-panel.css" />

    <style>
      @font-face {
        font-family: "GemFont One";
        src: url("/GemFont One.ttf");
        font-weight: 400;
      }
      @font-face {
        font-family: "Augusta";
        src: url("/Augusta.ttf");
        font-weight: 400;
      }
    </style>
  </head>
  <body>
    <div class="panels">
      <img class="bg-icon" alt="" src="/bg@2x.png" />

      <div class="bear-market-wrapper">
        <div class="bear-market" id="marketTitle">MARKET STATE</div>
      </div>
      
      <section class="market-state">
        <div class="market-state-revealed">Market State Revealed!</div>
        <div class="prices-are-volatile-the-marke-wrapper">
          <div class="prices-are-volatile-container" id="marketDescription">
            <!-- Content will be dynamically inserted -->
          </div>
        </div>
      </section>
      
      <section class="bear-illustration">
        <img class="panel-small-1" alt="" src="/panel-small-1@2x.png" />
        <img class="bear-icon" loading="lazy" alt="" id="marketIcon" />
      </section>
      
      <div class="continue-button-container-wrapper">
        <button class="continue-button-container">
          <img class="button-icon" alt="" src="/button1@2x.png" />
          <a class="continue">Continue</a>
        </button>
      </div>
    </div>

    <script type="module">
      import { audioManager, navigateToScreen } from './main.js';
      
      const marketStates = {
        'Bear Market': {
          title: 'BEAR MARKET',
          icon: '/bear@2x.png',
          description: `
            <p class="prices-are-volatile">Prices are falling!</p>
            <p class="the-market-is">The market is pessimistic and</p>
            <p class="moving-sideways">trending downward</p>
          `
        },
        'Bull Market': {
          title: 'BULL MARKET',
          icon: '/bull@2x.png',
          description: `
            <p class="prices-are-volatile">Prices are rising!</p>
            <p class="the-market-is">The market is optimistic and</p>
            <p class="moving-sideways">trending upward</p>
          `
        },
        'Choppy Market': {
          title: 'CHOPPY MARKET',
          icon: '/wave@2x.png',
          description: `
            <p class="prices-are-volatile">Prices are volatile!</p>
            <p class="the-market-is">The Market is uncertain and</p>
            <p class="moving-sideways">moving sideways</p>
          `
        }
      };

      document.addEventListener('DOMContentLoaded', () => {
        // Get market state from localStorage
        const currentMarket = localStorage.getItem('marketState') || 'Choppy Market';
        const state = marketStates[currentMarket];

        // Update UI with market state
        if (state) {
          document.getElementById('marketTitle').textContent = state.title;
          document.getElementById('marketIcon').src = state.icon;
          document.getElementById('marketDescription').innerHTML = state.description;
        }

        // Start background music on first interaction
        document.addEventListener('click', () => {
          audioManager.playBackgroundMusic();
        }, { once: true });

        // Handle continue button click
        const continueButton = document.querySelector('.continue-button-container');
        if (continueButton) {
          continueButton.addEventListener('click', () => {
            audioManager.playClickSound();
            navigateToScreen('coinflip.html');
          });
        }
      });
    </script>
  </body>
</html>
